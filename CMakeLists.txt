# usage:
#
# mkdir build; cd build; cmake ..
# or (on edison)
# mkdir build; cd build; cmake -DFULL_BUILD=OFF ..
#
cmake_minimum_required(VERSION 2.8.11)

include("cmake/FindCXXFeatures.cmake")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CXX11_COMPILER_FLAGS}")

include("cmake/GTest.cmake")

set(FULL_BUILD ON CACHE BOOL "enables full build or restrict to minimum")

if (${FULL_BUILD})
  include("cmake/ADOLC.cmake")
  include("cmake/POCO.cmake")
  include("cmake/ceres-solver.cmake")
  include("cmake/FindMongoDB.cmake")
  include("cmake/FindF2C.cmake")

  find_package(Armadillo REQUIRED)

  function(target_depends_on_armadillo target)
      target_link_libraries(${target} ${ARMADILLO_LIBRARY})
  endfunction()

  function(target_depends_on_f2c target)
    target_link_libraries(${target} ${F2C_LIBRARY})
  endfunction()

  find_library(M_LIB m)
  function(target_depends_on_m target)
    target_link_libraries(${target} ${M_LIB})
  endfunction()

  

# this include dir should be set per-target.
# However, cmake does not propagate this property to dependents. As a hack,
# the armadillo include dir will be accessible to all files.
# In the future, a variation of the following line might be useful:
# set_property(TARGET ${target} APPEND PROPERTY INCLUDE_DIRECTORIES ${ARMADILLO_INCLUDE_DIR})
  include_directories(${ARMADILLO_INCLUDE_DIR})
  include_directories(${F2C_INCLUDE_DIR})
  include_directories(${LibM_INCLUDES})
endif ()

find_package(Protobuf REQUIRED)
find_package(Boost REQUIRED COMPONENTS system iostreams filesystem)


include_directories(${CMAKE_SOURCE_DIR}/src)

add_definitions("-DON_SERVER")

add_subdirectory(src)
