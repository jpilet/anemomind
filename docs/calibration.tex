\documentclass{article}
\usepackage{textcomp}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{textcomp}
\usepackage[T1]{fontenc}
\usepackage{ucs}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{courier}
\usepackage{graphicx}
\usepackage{a4wide}

\newcommand{\minfun}{\text{min}}
\newcommand{\realvec}[1]{\mathbf{#1}}
\newcommand{\norm}[1]{\left| #1 \right|}
\newcommand{\derivative}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\timederivative}[1]{\derivative{#1}{t}}
\newcommand{\realnumber}{\mathbb{R}}
\setcounter{secnumdepth}{2}

\author{Jonas Ã–stlund}
\date{\today}
\title{Automatic Calibration of Nautical Instruments}

\begin{document}
\maketitle
\section{Introduction}
Properly calibrating instruments on a boat is important in order for sailors basing their decisions on sensor data to make close to optimal decisions that can help them win races. However, traditional calibration of instruments is a complicated procedure to carry out and therefore, many sailors skip it. It is therefore desirable to automate calibration in order to save time and let more sailors enjoy the benefits of properly calibrated nautical instruments.

However, automatic calibration of instruments is a difficult problem due to the many unknown parameters. Not only are the parameters of the instruments unknown, but also the local wind and current conditions. Therefore, domain knowledge is required to build a model that can lead to a well-posed optimization problem.

One such model is based on the assumption that when a manoeuver is performed and the local wind and current conditions are stable, a true wind and current estimated from improperly calibrated instruments would be unstable. Calibrating the instruments would make the estimated true wind and current to become stable. In practice, this could be implemented by minimizing the difference between true wind just before and just after a manoeuver. An approach based on this assumption is used by Team New Zealand, but it neverthless requires a substantial amount of manual labour.\footnote{According to Jean-Claude Monnin}. In order to obtain a stable estimate of the calibration parameters, the data need to be fitted to several different manoeuvers that are segmented out from data. Unfortunately, manoeuvers are sparse events and plenty of recorded data may be required to obtain sufficiently many manoeuvers over which to optimize. Furthermore, a manoeuver could be triggered by a sudden change in the wind direction. For instance, a sailor might perform a tack because a wind change lead to a less favourable VMG, which would make the assumption that the wind is relatively stable at manoeuvers less valid.

\section{Problem Formulation}
In this report, we attempt to address the concerns raised in the introduction. Specifically, we base our proposed solution on the following points:
\begin{enumerate}
 \item If the true wind and current are stable when a rapid change in the velocity of the boat takes place, we would expect the estimated true wind and current from the calibration parameters to be stable as well.
 \item If it is not true that the wind and current is stable at a rapid change in the boat velocity, the local measurements should have no influence on the calibration.
 \item We should be able to perform calibration also on limited amounts of data, e.g. recordings from a few hours of sailing.
\end{enumerate}.

\section{Optimization}
We formulate an optimization problem where we minimize an objective function w.r.t. $X \in \realnumber^n$ calibration parameters. The estimated true wind at a given moment is given by a function $\realvec{w}: \realnumber \times \realnumber^n \rightarrow \realnumber^2$ that maps a local time and calibration parameters to a realvector in a local two-dimensional coordinate system attached to the sea surface. For the current, we have a similar function $\realvec{c}: \realnumber \times \realnumber^n \rightarrow \realnumber^2$. We assume the GPS velocity realvector does not depend on any calibration parameters, but only the local time: $\realvec{g}: \realnumber \rightarrow \realnumber^2$. See Fig. ... for a diagram to estimate true wind and current from sensors.

We optimize the calibration parameters at densely sampled times $t_i \in \realnumber$ with $i$ in $1 \ldots N$. Typically, the difference between $t_i$ and $t_{i+1}$ could be a few seconds. We also introduce binary membership variables $a_i, b_i \in \{0, 1\}$ that determine whether or not to enforce wind or current stability, respectively.

With $\realvec{X} \in \realnumber^n$ being the calibration parameters and $\realvec{A} = (a_1, ..., a_N) \in \{0, 1\}^N$, $\realvec{B} = (b_1, ..., b_N) \in \{0, 1\}^N$ being the binary membership variables, we solve this optimization problem:
\begin{displaymath}
\underset{\realvec{X} \in \realnumber^n, \realvec{A} \in \{0, 1\}^N, \realvec{B} \in \{0, 1\}^N}{\text{Minimize}} \qquad \sum_{i = 1}^N  a_i\left(  q\norm{\timederivative{\realvec{w}}(t_i, \realvec{X})}^2 - \norm{\timederivative{\realvec{g}}(t_i)} \right)
+ b_i\left( q\norm{\timederivative{\realvec{c}}(t_i, \realvec{X})}^2 - \norm{\timederivative{\realvec{g}}(t_i)}\right) \, .
\end{displaymath}
The objective function tries to minimize the derivatives of estimated true wind and current whenever the corresponding membership variable is 1. The purpose of the derivative of the GPS velocity is to encourage the inclusion of measurements for which rapid changes in the velocity of the boat takes place. If it were excluded from the objective function, all membership variables could trivially be set to 0 and the result would be useless. A quality parameter $q \in \realnumber$ controls how stable we require the wind and current to be. A higher value of $q$ means that fewer membership variables will be 1 in the optimized result.

It is easy to see that given a parameter vector $\realvec{X}$, the membership variables can be estimated directly for each term indidually by just looking at its sign. This lets us eliminate the membership variables, and we get the problem:
\begin{displaymath}
\underset{\realvec{X} \in \realnumber^n}{\text{Minimize}} \qquad \sum_{i = 1}^N  \minfun\left(0, q\norm{\timederivative{\realvec{w}}(t_i, \realvec{X})}^2 - \norm{\timederivative{\realvec{g}}(t)}\right)
+ \minfun\left(0, q\norm{\timederivative{\realvec{c}}(t_i, \realvec{X})}^2 - \norm{\timederivative{\realvec{g}}(t)}\right) \, .
\end{displaymath}


\section{Implementation}
The derivatives in the objective function are estimated using finite differences. Differentiation increases noise, so the signals over which we optimize must be denoised before they can be used in the optimization, e.g. using second order Total Variation (TV) denoising which tends to produce piecewise constant derivatives of the signals.

The latter version of objective function where the membership variables have been eliminated is nonsmooth due to the $\minfun$ function but in practice it tends to converge even when minimized with an algorithm such as Levenberg-Marquardt.
\end{document}
